function FRError(n){var t=this;return t.name="Generic Error",t.message="Unknown",n&&typeof n=="string"&&(this.message=n),n&&typeof n=="object"&&(n.name&&(t.name=n.name),n.Name&&(t.name=n.Name),n.message&&(t.message=n.message),n.Message&&(t.message=n.Message),FRConfiguration.Environment=="Development"&&((n.ExceptionType||n.StackTrace)&&(t.message=t.message+"<br>"),n.ExceptionType&&(t.message=t.message+n.ExceptionType+" "),n.StackTrace&&(t.message=t.message+n.StackTrace+" "),(n.className||n.methodName)&&(t.message=t.message+"<br>"),n.className&&(t.message=t.message+n.className+" "),n.methodName&&(t.message=t.message+n.methodName+" "))),FRLog.error(t.name+": "+t.message),t}function getFrontiersApi(n,t){if($.browser&&$.browser.msie&&parseInt($.browser.version,10)<10&&window.XDomainRequest){var i=new window.XDomainRequest;i.open("get",n),i.onload=function(){t(eval("json = "+i.responseText))},i.onerror=function(){return},i.ontimeout=function(){return},i.onprogress=function(){return},setTimeout(function(){i.send()},0)}else $.getJSON(n,function(n){t(n)})}function ucfirst(n){return n.charAt(0).toUpperCase()+n.slice(1)}function killWhiteSpace(n){return n.replace(/\s/g,"")}function getProfileUrl(n,t){return siteUrl+"/Community/WhosWhoActivity.aspx?sname="+t+"&UID="+n}function showLoadingStatus(n,t){n?$("#"+t).show():$("#"+t).hide()}function getTrimmedFullName(n){if(n!=null)return n.length>40&&(n=n.substring(0,39)+"..."),n}function getTimeNow(){var n=new Date;return n.getMonth()+1+"/"+n.getDate()+"/"+n.getFullYear()+" "+n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()}function getTimezoneOffsetInHours(){var n=(new Date).getTimezoneOffset()/-60;return(n%1==0||n==0)&&(n=n+".0"),n}function return2br(n){return n.replace(/(\r\n|[\r\n])/g,"<br/>")}function Create2DArray(n){for(var i=[],t=0;t<n;t++)i[t]=[];return i}function StringBuilder(){this._array=[],this._index=0,this.append.apply(this,arguments)}function htmlEntities(n){return n=n.replace(/[<>]/g,function(n){return n==="<"?"&lt;":"&gt;"})}function formatTextContent(n){var t=n.replace(/\n/g,"<br/>"),i;return t=htmlEntities(t),i=$("<div/>").html(t).text()}function getQueryString(n){var i=window.location.search.substring(1),r,t,u;if(!i||!i.length)return"";for(r=i.split("&"),t=0;t<r.length;t++)if(u=r[t].split("="),u[0]==n)return u[1]}function getHashTag(n){var r=window.location.hash.substring(1),i,t;if(!r||!r.length)return"";for(i=r.split("/"),t=0;t<i.length;t++)if(i[t]==n)return i[t+1]}function makeLinks(n){var t,i,r,u;return i=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,t=n.replace(i,'<a href="$1" target="_blank">$1</a>'),r=/(^|[^\/])(www\.[\S]+(\b|$))/gim,t=t.replace(r,'$1<a href="http://$2" target="_blank">$2</a>'),u=/(\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*)/gim,t=t.replace(u,'<a href="mailto:$1">$1</a>')}function removeHTMLTags(n){var t=/(<([^>]+)>)/ig;return n!=""?n.replace(t,""):""}function removeWhiteSpaces(n){return n!=""?n.replace(/&nbsp;/gi,"").replace(/\/n/g,""):""}function showUserImage(n){FRSocialActivity.showUserImage(n)}function hideUserImage(n){FRSocialActivity.hideUserImage(n)}function showAllUsersFeedActivityPopup(n,t,i){FRSocialActivity.showAllUsersFeedActivityPopup(n,t,i)}function hideAllUsersFeedActivityPopup(n,t,i){FRSocialActivity.hideAllUsersFeedActivityPopup(n,t,i)}function AddComments(n){FRSocialActivity.comment.add(n)}function EditComments(n,t){FRSocialActivity.comment.edit(n,t)}function DeleteComments(n,t){FRSocialActivity.comment.deleteComment(n,t)}function inherits(n,t){function i(){}i.prototype=t.prototype,n.superClass_=t.prototype,n.prototype=new i,n.prototype.constructor=n}function MarkerLabel_(n,t){this.marker_=n,this.handCursorURL_=n.handCursorURL,this.labelDiv_=document.createElement("div"),this.labelDiv_.style.cssText="position: absolute; overflow: hidden;",this.eventDiv_=document.createElement("div"),this.eventDiv_.style.cssText=this.labelDiv_.style.cssText,this.eventDiv_.setAttribute("onselectstart","return false;"),this.eventDiv_.setAttribute("ondragstart","return false;"),this.crossDiv_=MarkerLabel_.getSharedCross(t)}function MarkerWithLabel(n){n=n||{},n.labelContent=n.labelContent||"",n.labelAnchor=n.labelAnchor||new google.maps.Point(0,0),n.labelClass=n.labelClass||"markerLabels",n.labelStyle=n.labelStyle||{},n.labelInBackground=n.labelInBackground||!1,typeof n.labelVisible=="undefined"&&(n.labelVisible=!0),typeof n.raiseOnDrag=="undefined"&&(n.raiseOnDrag=!0),typeof n.clickable=="undefined"&&(n.clickable=!0),typeof n.draggable=="undefined"&&(n.draggable=!1),typeof n.optimized=="undefined"&&(n.optimized=!1),n.crossImage=n.crossImage||"http"+(document.location.protocol==="https:"?"s":"")+"://maps.gstatic.com/intl/en_us/mapfiles/drag_cross_67_16.png",n.handCursor=n.handCursor||"http"+(document.location.protocol==="https:"?"s":"")+"://maps.gstatic.com/intl/en_us/mapfiles/closedhand_8_8.cur",n.optimized=!1,this.label=new MarkerLabel_(this,n.crossImage,n.handCursor),google.maps.Marker.apply(this,arguments)}var FRAlert=function(){var n=this,t=['<li class="alert">','<a class="close bypassSecurityPopup" href="javascript:void(0)">Ã—</a>','<div class="icon"></div>','<div class="content"></div>',"</li>"].join("");n.alert=$(t);n.alert.on("click",".close",function(){n.destroy(),$(document).trigger("afterClose.alert")});return n},FRLog,FRSafe,FRTemplate,FRNetworkUserFollow;FRAlert.prototype.init=function(n){var t=this;n&&(typeof n=="string"&&t.alert.find(".content").html(n),typeof n=="object"&&t.alert.find(".content").html(JSON.stringify(n))),n&&n.content&&t.alert.find(".content").html(n.content),n&&n.type&&t.alert.addClass(n.type)},FRAlert.prototype.show=function(){var n=this;n.alert.css({top:"-100px"}),$("#alerts").prepend(n.alert),n.alert.animate({top:0},"slow")},FRAlert.prototype.destroy=function(){var n=this;n.alert.remove()},FRAlert.prototype.basic=function(n){var t=this;t.init(n),t.alert.find(".icon").html('<i class="fr-icon-v2-info-circled"></i>'),t.show()},FRAlert.prototype.success=function(n){var t=this;t.init(n),t.alert.addClass("success"),t.alert.find(".icon").html('<i class="fr-icon-v2-ok-circle"></i>'),t.show(),t.alert.delay(6e3).fadeOut(500,function(){$(this).remove()})},FRAlert.prototype.warning=function(n){var t=this;t.init(n),t.alert.addClass("warning"),t.alert.find(".icon").html('<i class="fr-icon-v2-attention-circled"></i>'),t.show()},FRAlert.prototype.error=function(n){var t=this;t.init(n),t.alert.addClass("error"),t.alert.find(".icon").html('<i class="fr-icon-v2-cancel-circle"></i>'),t.show()},$(document).ready(function(){$(document).on("alert.success",function(n,t){var i=new FRAlert;i.success(t)});$(document).on("alert.error",function(n,t){var i=new FRAlert;i.error(t)});$(document).on("alert.basic",function(n,t){var i=new FRAlert;i.basic(t)});$(document).on("alert.warning",function(n,t){var i=new FRAlert;i.warning(t)})}),FRLog=function(){function s(){f||$(".ibar .loading").show()}function h(){f||$(".ibar .loading").hide()}function e(){f=!0,$(".ibar .loading").show(),$(".ibar .loading").html('<i class="fr-icon-v2-attention-circled"></i>')}function o(){}function n(n,f){if(FRConfiguration.Environment=="Development"&&(u.push(f),o(n,f)),n=="log"&&console.log(f),n=="basic"){var s=new FRAlert;s.basic(f)}n=="success"&&(t&&t.destroy(),t=new FRAlert,t.success(f)),n=="warning"&&(e(),i&&i.destroy(),i=new FRAlert,i.warning(f)),n=="error"&&(e(),r&&r.destroy(),r=new FRAlert,r.error(f))}function c(){console.log("FRLog | This is the full stack...");for(var n=0;n<u.length;n++)console.log(u[n])}var u=[],f=!1,t,i,r;return $(document).ajaxSend(function(){s()}),$(document).ajaxStop(function(){h()}),$(document).ajaxError(function(n,t,i,r){r=="abort"||r=="Abort"||e()}),{print:c,notify:o,basic:function(t){n("basic",t)},success:function(t){n("success",t)},warning:function(t){n("warning",t)},error:function(t){n("error",t)},debug:function(t){FRConfiguration.Environment=="Development"&&(console.log(t),n("basic",t))}}}(),function(){window.d=FRLog.debug}(),FRError.prototype=new Error,FRError.prototype.constructor=FRError,$(document).ajaxError(function(n,t,i,r){if(t&&t.responseText){var u=$.parseJSON(t.responseText);throw new FRError({name:"Server Error",message:u.Message,ExceptionType:u.ExceptionType,StackTrace:u.StackTrace});}else if(r=="timeout"||r=="Timeout")throw new FRError({name:"Connection Error",message:"Timeout"});else r=="abort"||r=="Abort"||FRConfiguration.Environment=="Development"}),window.onerror=function(){return FRConfiguration.Environment=="Development"?!1:FRConfiguration.Environment=="Test"?!1:FRConfiguration.Environment=="Live"?!0:void 0},FRSafe=function(){return{boolean:function(n){return n=="True"?!0:!1}}}(),$.extend({getFrontiersApi:function(n,t){return getFrontiersApi(n,t)},getHTML:function(n,t){return jQuery.get(n,undefined,t,"html")},getText:function(n,t){return jQuery.get(n,undefined,t,"text")}}),$.extend({ajaxCrossDomain:function(n){var t=$.extend({url:"",data:{},type:"GET",success:function(){}},n),r,i;t.data&&t.data.cookies&&$.isArray(t.data.cookies)&&t.data.cookies.length&&(r=FRCookie.getAll(t.data.cookies),t.data.cookies=FRBase64.encode(r)),$.browser&&$.browser.msie&&parseInt($.browser.version,10)<10&&window.XDomainRequest?(document.location.protocol=="http:"&&(t.url=t.url.replace("https:","http:")),i=new window.XDomainRequest,i.open(t.type,t.url),i.onload=function(){i.responseText&&i.responseText.length&&t.success(eval("json = "+i.responseText))},i.onerror=function(){return},i.ontimeout=function(){return},i.onprogress=function(){return},setTimeout(function(){i.send(JSON.stringify(t.data))},0)):$.ajax({dataType:"json",url:t.url,data:t.data,type:t.type}).done(function(n){t.success(n)})}}),function(n){var t={check:function(){var n=this.first();return n.data("disabled")?!0:(n.data("disabled",!0),!1)},clear:function(){return this.data("disabled",!1)}};n.fn.checkDuplicateEvent=function(n){return t[n]?t[n].apply(this):t.check.apply(this)}}(jQuery),StringBuilder.prototype.append=function(){for(var n=0;n<arguments.length;n++)this._array[this._index]=arguments[n],this._index++},StringBuilder.prototype.toString=function(){return this._array.join("")},$.fn.justtext=function(){return $(this).clone().children().remove().end().text()},$.fn.hasAttr=function(n){return this.attr(n)!==undefined},$.fn.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.leftTrim=function(){return this.replace(/^\s+/,"")},String.prototype.truncate=function(n){var t=this.toString();return t?t.length<=n?t:(t=t.substring(0,n),t=t.indexOf(" ")>0?t.replace(/\W*\s(\S)*$/,"..."):t+"..."):""},String.prototype.truncateKeywords=function(n,t){var r=this.length>n,i=r?this.substr(0,n-1):this;return i=t&&r?i.substr(0,i.lastIndexOf(" ")):i,r?i+"&nbsp;&hellip;":i},FRTemplate=function(){function i(i,r){if(!n||!n.length)return"";var u=t(i),f=_.template(u);return f(r)}function t(t){return n.map(function(){if(this.id==t)return $(this).html()}).get(0)}var n=$("#divTemplates").children();return{get:function(n){return t(n)},bind:function(n,t){return i(n,t)}}}(),$(document).ready(function(){$(document).on("ui.refresh",function(){$("select:not(select[multiple]).pretty").each(function(){$(this).hasClass("is-pretty")||($(this).select2({placeholder:"Select",width:"element"}),$(this).addClass("is-pretty"),$(this).css("display","none"))}),$(".frUIMouse").each(function(){$(this).hasClass("is-ui")||($(this).mouseover(function(){$(this).addClass("open")}),$(this).mouseout(function(){$(this).removeClass("open")}),$(this).addClass("is-ui"))}),$(".frUIAccordion").each(function(){var n=$(this);n.hasClass("is-ui")||(n.children(".header").click(function(){n.children(".content").toggleClass("hide"),n.children(".content").hasClass("hide")?(n.children(".header").find("i").removeClass("rounded-arrow-down"),n.children(".header").find("i").addClass("rounded-arrow-right")):(n.children(".header").find("i").removeClass("rounded-arrow-right"),n.children(".header").find("i").addClass("rounded-arrow-down"))}),$(this).addClass("is-ui"))}),$(".frUIToolTip").each(function(){$(this).hasClass("is-ui")||($(this).tooltip(),$(this).addClass("is-ui"))}),$(".frUIResizeTextArea").each(function(){$(this).hasClass("is-ui")||($(this).autosize(),$(this).addClass("is-ui animated-resize"))}),$(".frUIFitString").each(function(){if(!$(this).hasClass("is-ui")){var t=$(this),i=t.height(),n=t.children("span");for($(this).data("frUIFitString",$(n).text());$(n).outerHeight()>i;)$(n).text(function(n,t){return t.replace(/\W*\s(\S)*$/,"...")});$(this).addClass("is-ui")}}),$(".frUIFitStringWithTooltip").each(function(){var r,n,u,i,t,f;if(!$(this).hasClass("is-ui")){if(r=$(this),n=r.children("span"),n.text(n.data("original-title")),u=n.html(),i=n.html().length,i>0)while(parseInt(n.height())>parseInt(r.css("height")))i--,t=u.substr(0,i-1),t=t.substr(0,t.lastIndexOf(" ")),f=t+"&nbsp;&hellip;",n.html(f),n.tooltip({placement:"bottom",template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner keywordTooltip"></div></div>'});$(this).addClass("is-ui")}}),$(".input-prepend input, .input-append input").each(function(){$(this).hasClass("is-ui")||($(this).focus(function(){$(this).parent().find(".add-on").addClass("selected")}),$(this).blur(function(){$(this).parent().find(".add-on").removeClass("selected")}),$(this).addClass("is-ui"))})})}),$(document).ready(function(){$(document).on("string.refresh",function(){$(".frUIStringFit").each(function(){var i,n,r,t,u;if(!$(this).hasClass("is-ui")){if(i=$(this),n=i.children("span"),$(this).data("frUIStringFit",$(n).html()),r=$(n).html(),t=$(n).html().length,t>0)while(parseInt($(n).height())>parseInt(i.css("height")))t--,u=r.truncateKeywords(t,!0),$(n).html(u);$(this).addClass("is-ui")}})})}),$.fn.extend({frUIToggle:function(){return $(this).toggleClass("hide"),$(this)}}),$.fn.extend({frUIToggleActivityBoxFromBelow:function(){var t=$("#activityBoxAnimationEnd"),n;return $(this).hasClass("hide")?($("div.element.review.activityBox").addClass("hide"),$(this).css({x:"0px",y:"400px",scale:.1,opacity:.4}),$(this).removeClass("hide"),$(this).transition({x:"0px",y:"0px",scale:1,opacity:1},800,"ease"),n=t.offset().top-36-($(window).height()-$(this).outerHeight(!1))/2+$(window).height()/1e3*75,$(window).height()<$(this).outerHeight(!1)+72&&(n=t.offset().top-82),$("html, body").animate({scrollTop:n},800)):$(this).addClass("hide"),$(this)}}),$(document).ajaxComplete(function(){$(document).trigger("ui.refresh")}),$(document).ready(function(){$(document).on("ui.lock",function(){var t=$("body"),n;t.find("#overlay").length||(n=$(['<div id="overlay">','<div class="loading">','<div class="icon"><span class="fr-icon-v2-spin1 animate-spin"></span></div>','<div class="caption"><span>Please wait...</span></div>',"</div>","</div>"].join("")),t.prepend(n),setTimeout(function(){n.parent().length&&(n.remove(),FRLog.warning("An error occoured. If the problem persists, please contact the Frontiers support."))},6e4))});$(document).on("ui.unlock",function(){$("body").find("#overlay").remove()})}),$(function(){var n=BrowserDetect.init();if(n.browser=="Explorer"){$("body").addClass("ie");$(document).on("ui.refresh",function(){$("input[type='text']:disabled, textarea:disabled").each(function(){var n=$(this);n.removeAttr("disabled"),n.prop("readonly",!0)}),$("input, textarea").each(function(){var n=$(this),t;(n.val()==""||n.val()==null)&&(t=n.attr("placeholder"),n.val(t)),n.attr("placeholder")!=""&&$(this).val()==$(this).attr("placeholder")&&n.addClass("hasPlaceholder"),$("input, textarea").focus(function(){$(this).attr("placeholder")!=""&&$(this).val()==$(this).attr("placeholder")&&$(this).val("").removeClass("hasPlaceholder")}).blur(function(){$(this).attr("placeholder")!=""&&($(this).val()==""||$(this).val()==$(this).attr("placeholder"))&&$(this).val($(this).attr("placeholder")).addClass("hasPlaceholder")}),$("form").submit(function(){$(this).find(".hasPlaceholder").each(function(){$(this).val("")})})})})}});var FRTracking=function(){function n(n,t,i,r,u){if(window._gaq){r!="undefined"&&u!="undefined"?window._gaq.push(["_trackEvent",n,t,i,r,u]):window._gaq.push(["_trackEvent",n,t,i]);return}if(window.ga){window.ga("send","event",n,t,i);return}d({category:n,action:t,opt_label:i,opt_value:r,opt_noninteraction:u}),FRLog.warning("Google Analytics is not active on this page!")}$(document).on("click","a[data-tracking]",function(){var t=$(this).data("tracking");n(t.category,t.action,t.label)});var t=function(n,t,i,r){ga.hasOwnProperty("loaded")&&ga.loaded===!0?ga("send","event",n,t,i,{hitCallback:function(){document.location=r}}):document.location=r};return{event:n,trackOutboundLink:t}}(),BrowserDetect={init:function(){return this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS",this},searchString:function(n){for(var i,r,t=0;t<n.length;t++)if(i=n[t].string,r=n[t].prop,this.versionSearchString=n[t].versionSearch||n[t].identity,i){if(i.indexOf(n[t].subString)!=-1)return n[t].identity}else if(r)return n[t].identity},searchVersion:function(n){var t=n.indexOf(this.versionSearchString);if(t!=-1)return parseFloat(n.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]},FRCookie=function(){function n(n,t,i){var r=new Date,u;r.setDate(r.getDate()+i),u=JSON.stringify(t)+(i==null?"":"; expires="+r.toUTCString()),document.cookie=n+"="+u}function t(n){var t=document.cookie,i=t.indexOf(" "+n+"="),r;return i==-1&&(i=t.indexOf(n+"=")),i==-1?t=null:(i=t.indexOf("=",i)+1,r=t.indexOf(";",i),r==-1&&(r=t.length),t=t.substring(i,r)),t}function i(n){if(n&&n.length){var t=[];return $(n).each(function(n,i){var r=FRCookie.get(i);r&&r.length&&t.push(i+"="+r)}),t.join("; ")}}return{set:n,get:t,getAll:i}}(),FRBase64=function(){function t(n){var i,r,t;for(n=n.replace(/\r\n/g,"\n"),i="",r=0;r<n.length;r++)t=n.charCodeAt(r),t<128?i+=String.fromCharCode(t):t>127&&t<2048?(i+=String.fromCharCode(t>>6|192),i+=String.fromCharCode(t&63|128)):(i+=String.fromCharCode(t>>12|224),i+=String.fromCharCode(t>>6&63|128),i+=String.fromCharCode(t&63|128));return i}function i(n){for(var r="",t=0,i=c1=c2=0;t<n.length;)i=n.charCodeAt(t),i<128?(r+=String.fromCharCode(i),t++):i>191&&i<224?(c2=n.charCodeAt(t+1),r+=String.fromCharCode((i&31)<<6|c2&63),t+=2):(c2=n.charCodeAt(t+1),c3=n.charCodeAt(t+2),r+=String.fromCharCode((i&15)<<12|(c2&63)<<6|c3&63),t+=3);return r}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(i){var o="",s,r,u,c,l,h,f,e=0;for(i=t(i);e<i.length;)s=i.charCodeAt(e++),r=i.charCodeAt(e++),u=i.charCodeAt(e++),c=s>>2,l=(s&3)<<4|r>>4,h=(r&15)<<2|u>>6,f=u&63,isNaN(r)?h=f=64:isNaN(u)&&(f=64),o=o+n.charAt(c)+n.charAt(l)+n.charAt(h)+n.charAt(f);return o},decode:function(t){var r="",s,h,c,l,e,f,o,u=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<t.length;)l=n.indexOf(t.charAt(u++)),e=n.indexOf(t.charAt(u++)),f=n.indexOf(t.charAt(u++)),o=n.indexOf(t.charAt(u++)),s=l<<2|e>>4,h=(e&15)<<4|f>>2,c=(f&3)<<6|o,r=r+String.fromCharCode(s),f!=64&&(r=r+String.fromCharCode(h)),o!=64&&(r=r+String.fromCharCode(c));return r=i(r)}}}(),FRSocialActivity=function(){var u=$(".page-container"),i=u.find(".right-container"),n=u.find(".social-feed"),o=getTimeNow(),s=getTimezoneOffsetInHours(),r=window.FRConfiguration.FrontiersNetworkingAPIUrl,f=window.FRConfiguration.SharepointWebsiteUrl.replace("http://",""),t=function(){function w(){$(document).on("focus",".setfocus",function(){$(this).removeClass("grey_70").addClass("grey_90"),this.value==this.defaultValue&&(this.value=""),this.value!=this.defaultValue&&this.select()});$(document).on("blur",".setfocus",function(){$.trim(this.value).length||($(this).removeClass("grey_90").addClass("grey_70"),this.value=this.defaultValue?this.defaultValue:"")});$(document).click(function(i){var r=i.target?$(i.target):$(i.srcElement),u,f,o;r.parents().andSelf().is(".bubbleInfo,.fontnormal trigger")?(f=$("table.popup").filter(function(){return $(this).css("display")==="block"}),f.length>1&&(o=$("table.popup").filter(function(){return $(this).css("display")==="block"&&$(this).css("opacity")==1}),o.css("display","none"))):(u=$("table.popup"),t&&clearTimeout(t),t=setTimeout(function(){t=null,u.animate({top:"-="+a+"px",opacity:0},l,"swing",function(){e=!1,u.css("display","none")})},200),setTimeout(function(){u.css("filter")!="none"&&u.css("opacity")>0&&u.css({opacity:"0",filter:"alpha(opacity = 0)",top:"17px"})},300)),(r.is(n.find("a.showComment"))||r.is(n.find("a.showComment span"))||r.is(n.find("a.btmArrow span")))&&(r.parents("div.commentsWrapper").children("div.moreComments").css("display")=="none"?(r.is("a.showComment span.float_right")?r.removeClass("downArrow").addClass("upArrow"):r.parents("a.showComment").children("span.float_right").removeClass("downArrow").addClass("upArrow"),r.parents("div.CommentsHolder").children("div.commentBox:last").children("div.wrapper").children("div.content").children("ul.toolbar").children("li.float_right").html("<a href='javascript:void(0);' class='fontnormal btmArrow'><span class='upArrow float_right'></span></a>")):(r.is("a.showComment span.float_right")?r.removeClass("upArrow").addClass("downArrow"):r.parents("a.showComment").children("span.float_right").removeClass("upArrow").addClass("downArrow"),r.parent().is("a.btmArrow")?(r.parents("div.CommentsHolder").children("div.commentsWrapper").find("a.showComment span.float_right").removeClass("upArrow").addClass("downArrow"),r.parents("div.CommentsHolder").children("div.commentsWrapper").children("div.moreComments").toggle("slow"),r.parents("div.CommentsHolder").children("div.commentsWrapper").children("div.commentBox").children("div.float_left").children("a.showComment").focus(),r.parents("div.CommentsHolder").children("div.commentBox:last").children("div.wrapper").children("div.content").children("ul.toolbar").children("li.float_right").html("")):(r.is("a.showComment span.float_right")?r.removeClass("upArrow").addClass("downArrow"):r.parents("a.showComment").children("span.float_right").removeClass("upArrow").addClass("downArrow"),r.parents("div.CommentsHolder").children("div.commentBox:last").children("div.wrapper").children("div.content").children("ul.toolbar").children("li.float_right").html(""))),r.parents("div.commentsWrapper").children("div.moreComments").toggle("slow"),r.parents("div.CommentsHolder").children("div.commentsWrapper").children("div.commentBox").children("div.float_left").children("a.showComment").focus())})}function b(){var n={timeNow:o,itemId:window.FRSocial.itemId,ownerId:window.FRSocial.ownerId,currentHostName:f,entityId:window.FRSocial.entityId,itemTypeId:window.FRSocial.itemTypeId,ownerNwDbId:window.FRSocial.ownerNWDBId,timeOffset:s,conTemplateNetworkFeedKeyText:r,cookies:FRBase64.encode(FRCookie.getAll([FRConfiguration.FrontiersCookieRememberMe,FRConfiguration.FrontiersCookie]))},t;$.browser&&$.browser.msie&&parseInt($.browser.version)<=8?$.ajax({type:"POST",dataType:"json",traditional:!0,data:JSON.stringify(n),url:"/proxy/Network/GetEntityActivity"}).done(function(n){y(n)}):(t=$.browser&&$.browser.msie&&parseInt($.browser.version)==9?n:JSON.stringify(n),$.ajaxCrossDomain({type:"POST",data:t,url:window.FRConfiguration.FrontiersNetworkingAPIUrl+"/Network/GetEntityActivity",success:function(n){y(n)}}))}function y(t){var r=$.parseJSON(t);if(r&&r.length){i.find(".frontiers-network").show(),n.html(r[0]);var u=0,f=0,e=0;parseInt(r[1])>0&&(u=parseInt(r[1])),parseInt(r[2])>0&&(f=parseInt(r[2])),parseInt(r[3])>0&&(e=parseInt(r[3])),i.find(".frontiers-network .button-likes .final-counts").text(u),i.find(".frontiers-network .button-comments .final-counts").text(f),i.find(".frontiers-network .button-shares .final-counts").text(e),r[4]=="1"&&(i.find(".frontiers-network .like").text("Liked").addClass("liked").removeClass("like"),i.find(".frontiers-network .button-likes button").off("click")),$("#divmc_"+window.FRSocial.entityId+"_"+window.FRSocial.itemId).children().size()>0&&$("a.showComment").parents("div.CommentsHolder").children("div.commentBox:last").children("div.wrapper").children("div.content").children("ul.toolbar").children("li.float_right").html("<a href='javascript:void(0);' class='fontnormal btmArrow'><span class='upArrow float_right'></span></a>"),k(),n.find("textarea").addClass("frUIResizeTextArea comment-textarea").removeClass("w605 h15a fs11"),$(document).trigger("ui.refresh")}}function k(){if($("div.bubbleInfo").length>0){var n=300;$("div.bubbleInfo").each(function(){$(this).css("zIndex",n),n-=1})}}function d(n,i,r){var f,u;return h?!1:(h=!0,a=10,l=250,nt=200,v=27,t=null,c=!1,e=!1,f=n+"_"+i+"_"+r,$("#pAllUsers_"+f).text().indexOf(",...")!=-1)?(u=$("#tblAllUsers_"+f).css("opacity",0),t&&clearTimeout(t),c||e)?!1:(c=!0,u.css({top:v,left:2,display:"block"}).animate({top:"-="+a+"px",opacity:1},l,"swing",function(){c=!1,e=!0}),setTimeout(function(){u.css("filter")!="none"&&u.css("opacity")<1&&u.css({opacity:"1",filter:"alpha(opacity = 100)",top:"17px"}),h=!1},300),!1):(h=!1,!1)}function g(n,i,r){var u=$("#tblAllUsers_"+n+"_"+i+"_"+r);return t&&clearTimeout(t),t=setTimeout(function(){t=null,u.animate({top:"-="+a+"px",opacity:0},l,"swing",function(){e=!1,u.css("display","none")})},200),setTimeout(function(){u.css("filter")!="none"&&u.css("opacity")>0&&u.css({opacity:"0",filter:"alpha(opacity = 0)",top:"17px"})},300),!1}function p(){if($(".modal.login-modal").length){$(".modal.login-modal").modal("show");return}var n=window.FRConfiguration.SharepointWebsiteUrl+"/Login.aspx?returnurl="+document.location.href,t=$(['<div class="modal login-modal fade" data-backdrop="static">','<div class="modal-dialog">','<div class="modal-content">','<div class="modal-header">','<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>',"<h4>Login Required</h4>","</div>",'<div class="modal-body">',"<p>This action requires you to be registered with Frontiers and logged in. To register or login click <a href="+n+">here.</a> </p>","</div>",'<div class="modal-footer">','<button type="button" class="btn btn-flat btn-close btn-new-orange" data-dismiss="modal">Close</button>',"</div>","</div>","</div>","</div>"].join(""));u.append(t),u.find(".modal.login-modal").modal("show")}function tt(n,t){switch(parseInt(n)){case 14:switch(parseInt(t)){case 3:r="ART_SUBJL";break;case 6:r="ART_ACCEPT";break;case 35:r="PUB_EV_ABS";break;case 8:r="ART_PUBLSH";break;case 39:r="ART_PAPEND";break;default:r="ART_SUBJL"}break;case 12:r="RT_LAUNCH"}return r}var l,e,a,v,nt,c,t,h=!1,r="";return $(function(){if(typeof window.FRSocial=="undefined"||window.FRSocial.itemId<=0){!n||!n.length;return}tt(window.FRSocial.itemId,window.FRSocial.subItemId),w(),b()}),{showLoginPopUp:p,showAllUsersFeedActivityPopup:d,hideAllUsersFeedActivityPopup:g,getFeedTemplateKeyText:function(){return r}}}(),h=function(){function u(){i.find(".frontiers-network .like").on("click",function(){ga("send","event","AP_Action","button","like-article"),window.FRSocial.loginUserId==0?t.showLoginPopUp():($(this).text("Liked").addClass("liked").removeClass("like"),i.find(".frontiers-network .button-likes button").off("click"),e())})}function e(){var n={itemId:window.FRSocial.itemId,itemTypeId:window.FRSocial.itemTypeId,ownerId:window.FRSocial.ownerId,ownerNwDbId:window.FRSocial.ownerNWDBId,entityId:window.FRSocial.entityId,conTemplateNetworkFeedKeyText:t.getFeedTemplateKeyText(),isFollowing:!1,iskeywordFollowing:!1,isJournalFollowing:!1,cookies:[FRConfiguration.FrontiersCookieRememberMe,FRConfiguration.FrontiersCookie]};$.ajaxCrossDomain({type:"POST",url:r+"/Network/SaveLikeActivity",data:n,success:function(){var n=i.find(".frontiers-network .button-likes .final-counts"),t=parseInt(n.text())+1;n.text(t),o()}})}function o(){var n={itemId:window.FRSocial.itemId,ownerId:window.FRSocial.ownerId,ownerNwDbId:window.FRSocial.ownerNWDBId,entityId:window.FRSocial.entityId,conTemplateNetworkFeedKeyText:t.getFeedTemplateKeyText(),url:f,cookies:[FRConfiguration.FrontiersCookieRememberMe,FRConfiguration.FrontiersCookie]};$.ajaxCrossDomain({url:r+"/Network/GetLikeActivity",type:"POST",data:n,success:function(n){var t=$.parseJSON(n);t&&t.length&&s(t)}})}function s(t){if(t&&t.length&&t[1]!=null&&t[2]!=null){var i="divActivityBox_"+window.FRSocial.entityId+"_"+window.FRSocial.itemId+"_1",r="divActivityBox_"+window.FRSocial.entityId+"_"+window.FRSocial.itemId+"_3";$("#"+i).length?($("#"+i+" p").html(t[1]),$("#"+i+" table").html($(t[2]).html())):$("#"+r).length?$("#"+r).after('<div id="'+i+'" class="commentBox bubbleInfo" style="z-index: 300;"><p id="pAllUsers_'+window.FRSocial.entityId+"_"+window.FRSocial.itemId+'_1" class="pb0">'+t[1]+"</p>"+t[2]+"</div>"):n.prepend('<div id="'+i+'" class="commentBox bubbleInfo" style="z-index: 300;"><p id="pAllUsers_'+window.FRSocial.entityId+"_"+window.FRSocial.itemId+'_1" class="pb0">'+t[1]+"</p>"+t[2]+"</div>")}}$(function(){u()})}(),e=function(){function tt(){n.find(".write-area").on("focus",function(){$(".profile-thumbnail").show(),n.find(".write-area").css("width","603px;")});n.find(".write-area").on("blur",function(){$(".profile-thumbnail").hide(),n.find(".write-area").css("width","653px;")});i.on("click",".frontiers-network .comment",function(){ga("send","event","AP_Action","button","comment-article");var i=$("#txtComment");i&&i.length!=0&&(window.FRSocial.loginUserId==0?t.showLoginPopUp():($("html, body").animate({scrollTop:i.offset().top-100},500),n.find("#txtComment").focus()))});$(document).on("click","a.show-comment ,li.bottom-arrow ",function(){$(".comments-holder .more-comment-box").hasClass("hide")?($(".comments-holder .more-comment-box").show(),$(".comments-holder .more-comment-box").removeClass("hide"),$(".bottom-arrow a").show(),$(".comments-holder .show-comment span").removeClass("down-arrow"),$(".comments-holder .show-comment span").addClass("up-arrow")):($(".comments-holder .more-comment-box").addClass("hide"),$(".comments-holder .more-comment-box").hide(),$(".bottom-arrow a").hide(),$(".comments-holder .show-comment span").removeClass("up-arrow"),$(".comments-holder .show-comment span").addClass("down-arrow"))})}function nt(){var f;if(parseInt(window.FRSocial.loginUserId)==0)return t.showLoginPopUp(),!1;if(n.find("#txtComment").val()=="Write a comment...")return!1;var e=encodeURIComponent(return2br($.trim(n.find("#txtComment").val()))),o="Comments must be less than 4,000 characters. You have entered ",s="Comment text too long",c=$.trim(n.find("#txtComment").val());if(!l(c,"","","","",o,s))return!1;n.find("#txtComment").val("Write a comment...").trigger("autosize.resize"),f={entityId:window.FRSocial.entityId,itemId:window.FRSocial.itemId,itemTypeId:window.FRSocial.itemTypeId,conTemplateNetworkFeedKeyText:t.getFeedTemplateKeyText(),ownerNwDbId:window.FRSocial.ownerNWDBId,commentId:0,commentText:e,parentCommentId:0,commentLevel:1,action:0,cookies:[FRConfiguration.FrontiersCookieRememberMe,FRConfiguration.FrontiersCookie]},$.ajaxCrossDomain({type:"POST",url:r+"/Network/AddEditDeleteComment",data:f,success:function(n){var t=i.find(".frontiers-network .button-comments .final-counts"),r=parseInt(t.text())+1;t.text(r),h(n,1)}})}function g(n,t){var i=n.id.split("_"),r=i[1]+"_"+i[2]+"_"+i[3]+"_"+i[4],u;$("#div_"+t).append('<div id="divCommentTemp" style="display:none;">'+$("#div_"+t+" p.mtm3").html()+"</div>"),$("#div_"+t+" #divCommentTemp a.fontnormal").first().remove(),u=c($("#div_"+t+" #divCommentTemp").html()),$("#div_"+t+" #divCommentTemp").remove();var f=$("#div_"+t+" .toolbar  a.btmArrow").length?1:0,e=$("#div_"+t+" p:last").text(),o=$(['<div class="wrapper pt4 pb4 wAuto">','<textarea onfocus="showUserImage(this)" onblur="hideUserImage(this)" id="txtUpdate_'+r+"_"+t+'" style="overflow: hidden;" cols="2" rows="1" class="grey_90 comment-textarea write nrsize frUIResizeTextArea h15a fs11"> ',u+"</textarea> ",'</div><div class="commentAddWrap"><div>','<a class="addBtnComment" href="javascript:void(0);" data-date="date" onClick="FRSocialActivity.comment.update(this,\''+e+"','"+t+"',"+f+')" id="btnUpdatecom_'+r+'">',"<span>Add</span>","</a>","</div>","</div>"].join(""));$("#div_"+t).html(o),$(document).trigger("ui.refresh"),$("#txtUpdate_"+r+"_"+t).focus()}function d(n,i){var u=i.split("_"),f,e;$("#div_"+i).append('<div id="divCommentTemp" style="display:none;">'+$("#div_"+i+" p.mtm3").html()+"</div>"),$("#div_"+i+" #divCommentTemp a.fontnormal").first().remove(),f=c($("#div_"+i+" #divCommentTemp").html()),$("#div_"+i+" #divCommentTemp").remove(),e={entityId:window.FRSocial.entityId,itemId:window.FRSocial.itemId,itemTypeId:window.FRSocial.itemTypeId,conTemplateNetworkFeedKeyText:t.getFeedTemplateKeyText(),ownerNwDbId:u[1],commentId:u[0],commentText:f,parentCommentId:0,commentLevel:1,action:1,cookies:[FRConfiguration.FrontiersCookieRememberMe,FRConfiguration.FrontiersCookie]},$.ajaxCrossDomain({type:"POST",url:r+"/Network/AddEditDeleteComment",data:e,success:function(n){h(n,3)}})}function k(i,u,f){var c=f.split("_"),o=i.id.split("_"),s=o[1]+"_"+o[2]+"_"+o[3]+"_"+o[4],a;if($.trim($(" #txtUpdate_"+s+"_"+f).val()).length){var v=encodeURIComponent(return2br($.trim($(" #txtUpdate_"+s+"_"+f).val()))),y=$.trim($(" #txtUpdate_"+s+"_"+f).val()),p="Comments must be less than 4,000 characters. You have entered ",w="Comment text too long",b=[FRConfiguration.FrontiersCookieRememberMe,FRConfiguration.FrontiersCookie];l(y,"","","","",p,w)&&($("#btnUpdatecom_"+s).hide(),a={entityId:window.FRSocial.entityId,itemId:window.FRSocial.itemId,itemTypeId:window.FRSocial.itemTypeId,conTemplateNetworkFeedKeyText:t.getFeedTemplateKeyText(),ownerNwDbId:c[1],commentId:c[0],commentText:v,parentCommentId:0,commentLevel:1,action:2,cookies:b},$.ajaxCrossDomain({type:"POST",url:r+"/Network/AddEditDeleteComment",data:a,success:function(t){h(t,2),n.find("#txtComment").val("Write a comment...").trigger("autosize.resize")}}))}}function h(n,t){var i={entityId:window.FRSocial.entityId,ownerId:window.FRSocial.ownerId,itemId:window.FRSocial.itemId,userActivityFeedId:0,commentId:n,url:f,ownerNwDbId:window.FRSocial.ownerNWDBId,itemTypeId:window.FRSocial.itemTypeId,timeOffset:s,timeNow:o,cookies:[FRConfiguration.FrontiersCookieRememberMe,FRConfiguration.FrontiersCookie]};$.ajaxCrossDomain({type:"POST",url:r+"/Network/GetNewComment",data:i,success:function(i){var r=$.parseJSON(i);r&&r.length&&(t==1?it(r):t==2?b(r,n):t==3&&w(r,n),p())}})}function it(n){var i="divCommentHolder_"+n[0],t,r;$("#"+i).length?($("#"+i).append(n[1]),t=$("div.CommentsHolder"),t.find("a.btmArrow").length&&(t.find("a.btmArrow").remove(),t.find("div.commentBox:last ul li:last").append(e))):(r="divAddComment_"+n[0],$("#"+r).before('<div id="'+i+'" class="w100pc float_left CommentsHolder"><div class="w100pc float_left m0 p0 commentsWrapper"><div id="divActivityBox_'+window.FRSocial.entityId+"_"+window.FRSocial.itemId+'_2" class="commentBox bubbleInfo" style="z-index: 299;"></div></div>'+n[1]+"</div>"))}function b(n,t){var i=$("div.CommentsHolder");i.find("#divmc_"+window.FRSocial.entityId+"_"+window.FRSocial.itemId+" div.commentBox").length&&!i.find("div.commentBox:last ul li:last a.btmArrow").length?(i.find("#div_"+t+"_"+window.FRSocial.ownerNWDBId).html($(n[1]).html()),i.find("div.commentBox:last ul li:last").append(e)):i.find("#div_"+t+"_"+window.FRSocial.ownerNWDBId).html($(n[1]).html())}function w(n,t){var i=$("div.CommentsHolder");i.find("#div_"+t+"_"+window.FRSocial.ownerNWDBId+" a.btmArrow").length?(i.find("#div_"+t+"_"+window.FRSocial.ownerNWDBId+" a.btmArrow").remove(),i.find("#div_"+t+"_"+window.FRSocial.ownerNWDBId).html($(n[1]).html()),i.find("div.commentBox:last ul li:last").append(e)):i.find("#div_"+t+"_"+window.FRSocial.ownerNWDBId).html($(n[1]).html())}function p(){var n={entityId:window.FRSocial.entityId,itemTypeId:window.FRSocial.itemTypeId,ownerId:window.FRSocial.ownerId,userActivityFeedId:0,conTemplateNetworkFeedKeyText:t.getFeedTemplateKeyText(),url:f,ownerNwDbId:window.FRSocial.ownerNWDBId,createdBy:0,itemId:window.FRSocial.itemId,cookies:[FRConfiguration.FrontiersCookieRememberMe,FRConfiguration.FrontiersCookie]};$.ajaxCrossDomain({type:"POST",url:r+"/Network/GetCommentActivity",data:n,success:function(n){var t=$.parseJSON(n),i;t&&t.length&&t[1]!=null&&t[2]!=null&&(i="#divCommentHolder_"+t[0],$(i+" div.bubbleInfo p").length?($(i+" div.bubbleInfo p").html(t[1]),$(i+" div.bubbleInfo table").html($(t[2]).html())):$("#divActivityBox_"+window.FRSocial.entityId+"_"+window.FRSocial.itemId+"_2").html('<div class="float_left w100pc"><p id="pAllUsers_'+window.FRSocial.entityId+"_"+window.FRSocial.itemId+'_2" class="pb0 float_left w581">'+t[1]+"</p>"+t[3]+"</div>"+t[2]))}})}function y(n){if(parseInt(window.FRSocial.loginUserId)==0){t.showLoginPopUp();return}if($(n).parent().prev().length)$(n).parent().prev().show();else{var i='<div class="imgTn32" style="display: block;"><img src="'+window.FRSocial.loopUrl+"/images/profile/"+window.FRSocial.loginUserId+'/32" alt="" onerror="this.src=\'/Images/Frontiers/Common/Profile/default_profile_32.jpg\';"></div>';$(n).parent().before(i)}$(n).addClass("comment-text-focus")}function v(n){$(n).parent().prev().hide(),$(n).removeClass("comment-text-focus")}function c(n){return a(n.replace(/<br\s*[\/]?>/gi,"\n"))}function a(n){for(var i=new RegExp("<a[^>]*>(.*?)</a>","i"),t;i.test(n);)t=i.exec(n),t!=null&&t.length>1&&(n=n.replace(i,t[1]));return n}function l(n,t,i,r,u,f,e){var o=4e3,s;return n.length>o||r.length>o?(s=n.length>o?n.length:r.length,f=f+s+" characters here.",rt(f,e)):n==""&&t==""&&i==""&&r==""&&u==""?!1:!0}function rt(n,t){var i=$(".modal.login-modal"),r;if(i.length){i.find(".modal-header h4").text(t),i.find(".modal-body p").text(n),i.modal("show");return}r=$(['<div class="modal login-modal fade" data-backdrop="static">','<div class="modal-dialog">','<div class="modal-content">','<div class="modal-header">','<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>',"<h4>"+t+"</h4>","</div>",'<div class="modal-body">',"<p>"+n+"</p>","</div>",'<div class="modal-footer">','<button type="button" class="btn btn-flat btn-close btn-new-orange" data-dismiss="modal">Close</button>',"</div>","</div>","</div>","</div>"].join("")),u.append(r),u.find(".modal.login-modal").modal("show")}var e=$(['<a class="fontnormal btmArrow" href="javascript:void(0);">','<span class="upArrow float_right"></span>',"</a>"].join(""));return $(function(){tt()}),{showUserImage:y,hideUserImage:v,addComment:nt,editComment:g,updateComment:k,deleteComment:d}}(),c=function(){function e(){i.find(".frontiers-network .button-shares .share").on("click",function(){h(this)})}function h(n){if(parseInt(window.FRSocial.loginUserId)==0)return t.showLoginPopUp(),!1;if($(n).checkDuplicateEvent())return!1;var i={entityId:window.FRSocial.entityId,itemId:window.FRSocial.itemId,ownerId:window.FRSocial.ownerId,url:f,ownerNWDBId:window.FRSocial.ownerNWDBId,userActivityFeedId:0,itemTypeId:window.FRSocial.itemTypeId,timeOffset:s,timeNow:o,postedDate:o,isFollowing:!1,isKeywordFollowing:!1,isJournalFollowing:!1,cookies:[FRConfiguration.FrontiersCookieRememberMe,FRConfiguration.FrontiersCookie]};$.ajaxCrossDomain({type:"POST",url:r+"/Network/GetFeedDetails",data:i,success:function(t){var i=$.parseJSON(t);if(i||i.length){c(i),$(n).checkDuplicateEvent("clear");return}}})}function c(n){var w=window.FRSocial.entityId+"_"+window.FRSocial.ownerId+"_"+window.FRSocial.itemId+"_0",c="",p="",y="",e="",o="",r=$('<div id="divCommunitySharePopup" class="boxwithShadowX_new shadowX"></div>'),d=['<div class="shareTxt">','<div class="imageShare">','<img id="imgUser" width="32" height="32" alt="" src="/Images/Frontiers/Common/Profile/default_profile_32.jpg" />',"</div>",'<textarea id="txtSharePopupComment" rows="1" class="share-textarea setfocus frUIResizeTextArea pull-right"></textarea>',"</div>"].join(""),b=['<div id="divShrContent" class="shareContent editableContent">','<div class="pull-left share-feed">','<div id="divSharePopupContent" class="innerBoxsection mt0">',"</div>","</div>","</div>"].join(""),k=['<div class="float_left w100pc" id="divCommunityCommonPrivacy">','<input id="slctCommunityCommonPrivacy" type="hidden" class="frUIPrivacy large" style="width: 480px" />',"</div>"].join(""),h=$("<div/>"),i,t,a,s,f;if($('<button class="btn btn-new-orange btn-flat pull-left" data-dismiss="modal">SHARE</button>').click(function(){l()}).appendTo(h),$('<button data-dismiss="modal" class="btn btn-new-grey btn-flat">CANCEL</button>').appendTo(h),r.append(d).append(b).append(k),i=r.find("#divSharePopupContent"),t=$("<div/>"),t.html(n[0]),a=t.find("div.imgWrap").html(),a!=undefined&&a!=""&&(c=t.find("div.imgWrap").html().replace(/Thumb_50/g,"Thumb_32").replace(/default_profile_50/g,"default_profile_32")),y=t.find("div.contentWrap div.wrapper").html(),t.find("#divImgContent_"+w).length&&(e='<div id="divImgContent" class="contentWrap pt10" >'+t.find("#divImgContent_"+w).html()+"</div>"),t.html(""),r.find("#imgUser").attr({src:window.FRSocial.sanPath+"Profile Library/"+window.FRSocial.loginUserId+"/Thumb_32.jpg?date="+new Date,onerror:"this.src='/Images/Frontiers/Common/Profile/default_profile_32.jpg';"}),o=e==""?['<p class="innerBoxTitleText">',"Original post:</p>",'<div class="contentBox innerBox">','<div id="divImg" class="imgWrap">'+c+"</div>",'<div class="contentWrap">',p+y+"</div>","</div>",'<div class="clear">',"</div>"].join(""):['<p class="innerBoxTitleText">',"Original post:</p>",'<div class="contentBox innerBox">','<div id="divImg" class="imgWrap">',c+"</div>",'<div class="contentWrap">',p+y+"</div>",e+"</div>",'<div class="clear">',"</div>"].join(""),i.append(o),i.find("div.content").parent().find("div.imgHolder").length?i.find("div.content").removeClass("w465").addClass("w320"):i.find("div.content").removeClass("w465").addClass("w455"),i.find("div.content").find("p").removeClass("w515"),i.find("div.content").find("div.w100pc").find("p").addClass("wAuto"),i.find("#divImgContent").find("div.imgHolder").addClass("ml8"),u.find("#txtSharePopupComment").val(""),s=$(".modal.share-modal"),s.length){s.modal("show");return}f=$(['<div class="modal share-modal fade" data-backdrop="static">','<div class="container"><div class="row"><div class="modal-dialog">','<div class="modal-content">','<div class="modal-header">','<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>',"<h4>Share this post</h4>","</div>",'<div class="modal-body">',"</div>",'<div class="modal-footer">',"</div>","</div>","</div>","</div>","</div>","</div>"].join("")),f.find(".modal-body").append(r),f.find(".modal-footer").append(h),u.append(f),u.find(".modal.share-modal").modal("show"),$(document).trigger("ui.refresh"),$(".modal.share-modal").find(".shareTxt textarea").focus(),v()}function l(){var u=escape(return2br($.trim($("#divCommunitySharePopup #txtSharePopupComment").val()))),f,n,e,o;u=u==""?"||":u,f=window.FRSocial.entityId+"_"+window.FRSocial.ownerId+"_"+window.FRSocial.itemId+"_0",n="",$("#divCommunitySharePopup #divSharePopupContent #divAct_"+f+" div.float_left").length&&(n=$("#divCommunitySharePopup #divSharePopupContent #divAct_"+f+" div.float_left").html()),$("#divCommunitySharePopup #divSharePopupContent #divImgContent").length&&(n=n+'<div  class="contentWrap pt5" >'+$("#divCommunitySharePopup #divImgContent").html()+"</div>"),e=w(),n=escape(n),o={entityId:window.FRSocial.entityId,itemId:window.FRSocial.itemId,currentItemTypeId:1,ownerId:window.FRSocial.ownerId,shareText:u,activityText:n,imageUrl:"",privacyDetails:e,conTemplateNetworkFeedKeyText:t.getFeedTemplateKeyText(),ownerNwDbId:window.FRSocial.ownerNWDBId,feedInfoText:null,cookies:[FRConfiguration.FrontiersCookieRememberMe,FRConfiguration.FrontiersCookie]},$.ajaxCrossDomain({type:"POST",url:r+"/Network/SaveShare",data:o,success:function(){var n=i.find(".frontiers-network .button-shares .final-counts"),t=parseInt(n.text())+1;n.text(t),a()}})}function a(){var i={entityId:window.FRSocial.entityId,itemId:window.FRSocial.itemId,itemTypeId:window.FRSocial.itemTypeId,ownerId:window.FRSocial.ownerId,userActivityFeedId:0,conTemplateNetworkFeedKeyText:t.getFeedTemplateKeyText(),url:f,ownerNwDbId:window.FRSocial.ownerNWDBId,createdBy:0,cookies:[FRConfiguration.FrontiersCookieRememberMe,FRConfiguration.FrontiersCookie]};$.ajaxCrossDomain({type:"POST",url:r+"/Network/GetShareActivity",data:i,success:function(t){var i=$.parseJSON(t),r;i&&i.length&&i[1]!=null&&i[2]!=null&&(r="divActivityBox_"+window.FRSocial.entityId+"_"+window.FRSocial.itemId+"_3",$("#"+r).length?($("#"+r+" p").html(i[1]),$("#"+r+" table").html($(i[2]).html())):n.prepend('<div id="'+r+'" class="commentBox bubbleInfo" style="z-index: 300;"><p id="pAllUsers_'+window.FRSocial.entityId+"_"+window.FRSocial.itemId+'_3" class="pb0">'+i[1]+"</p>"+i[2]+"</div>"))}})}function v(){var n=$("#slctCommunityCommonPrivacy");if(!n.hasClass("is-pretty")){n.select2({placeholder:"Add lists or people to share this with.",width:"element",multiple:!0,id:function(n){return n.value+":"+n.key},ajax:{url:r+"/Network/GetOptionsList",dataType:"jsonp",type:"POST",xhrFields:{withCredentials:!0},data:function(n){return{tag:n.leftTrim(),loginUserId:window.FRSocial.loginUserId}},results:function(n){var o=$.parseJSON(n).d,i=$.parseJSON(o),e=$.map(i,function(n,t){var i=n.value.split("_");if(i[1]=="ROLE"&&(parseInt(i[0])>0||parseInt(i[0])==-3||parseInt(i[0])==-7))return t}),r,u,f;return e&&e.length&&(r=e[0],r>0&&(console.log("firstListIndex : "+r),i.splice(r,0,{key:"----------------",value:"0",disabled:!0}))),u=$.map(i,function(n,t){if(n.value.indexOf("_USER")>=0)return t}),u&&u.length&&(f=u[0],f>0&&(console.log("indexUser : "+f),i.splice(f,0,{key:"----------------",value:"0",disabled:!0}))),{results:i}}},formatResult:function(n){var i="",t,r,u;if(n.value=="0")i=$('<div class="thinline"></div>');else{if(r=n.value.split("_"),r[1]=="USER"){u=$("<img>",{alt:"img",width:"32px",height:"32px",src:window.FRConfiguration.SANVirtualPath+"/Profile Library/"+r[0]+"/Thumb_24.jpg"});u.on("error",function(){this.src="/Images/Frontiers/Common/Profile/default-profile-24.jpg"});t=$('<div class="pull-left"></div>'),t.append(u)}i=t&&t.length?t.add('<div class="textWrapper">'+n.key+"</div>"):$('<div class="textWrapper">'+n.key+"</div>")}return i},formatResultCssClass:function(n){var t="",i=n.value.split("_");return n.value=="0"?t="thinlineWrapper":i[1]=="ROLE"&&(parseInt(i[0])>0||i[0]!="-1"&&i[0]!="-3")&&(t="text-indent"),n.value.indexOf("_USER")>=0&&(t+="thumbnailWrapper"),t},formatSelection:function(n){var t=n.key=="Public"?"green-choice":"orange-choice";return'<span data-class="'+t+'">'+n.key+"</span>"},formatNoMatches:function(n){return"No search results found for "+n},escapeMarkup:function(n){return n}}),n.select2("data",{key:"Public",value:"0_PUBLIC",locked:!0});n.on("change",function(t){var i=y(n,t);n.select2("data",i),p()});n.addClass("is-pretty")}}function y(n,t){var i=n.select2("data"),r,u,f,e;return i.length||(i={key:"Public",value:"0_PUBLIC",locked:!0}),t.added&&(t.added.value=="0_PUBLIC"?i={key:"Public",value:"0_PUBLIC",locked:!0}:(r=$(i).map(function(){if(this.value!="0_PUBLIC")return this}),r.length&&(i=r)),t.added.value=="-3_ROLE"?(u=$(i).map(function(){var n=this.value.split("_");if(n[1]!="ROLE"||n[0]=="-3")return this}),u.length&&(i=u)):(f=t.added.value.split("_"),f[1]=="ROLE"&&f[0]!="-3"&&(e=$(i).map(function(){if(this.value!="-3_ROLE")return this}),e.length&&(i=e)))),i}function p(){$("#divCommunityCommonPrivacy .select2-choices span[data-class]").each(function(){var n=$(this).data("class");$(this).parent().parent().addClass(n)})}function w(){var n=[],t=[],r=[],u=[],f=[],e=$("#slctCommunityCommonPrivacy").select2("data"),i;return $(e).each(function(i,r){var u=r.value.split("_");switch(u[1]){case"USER":t.push(u[0]);break;case"ROLE":n.push(u[0].replace("-1","1").replace("-7","7").replace("-3","0"))}}),i=t+"|"+n+"|"+r+"|"+u+"|"+f}$(function(){e()})}();return{showUserImage:e.showUserImage,hideUserImage:e.hideUserImage,showAllUsersFeedActivityPopup:t.showAllUsersFeedActivityPopup,hideAllUsersFeedActivityPopup:t.hideAllUsersFeedActivityPopup,comment:{add:e.addComment,edit:e.editComment,update:e.updateComment,deleteComment:e.deleteComment}}}();inherits(MarkerLabel_,google.maps.OverlayView),MarkerLabel_.getSharedCross=function(n){var t;return typeof MarkerLabel_.getSharedCross.crossDiv=="undefined"&&(t=document.createElement("img"),t.style.cssText="position: absolute; z-index: 1000002; display: none;",t.style.marginLeft="-8px",t.style.marginTop="-9px",t.src=n,MarkerLabel_.getSharedCross.crossDiv=t),MarkerLabel_.getSharedCross.crossDiv},MarkerLabel_.prototype.onAdd=function(){var n=this,r=!1,t=!1,o,s,h,f,i,c,l,u=20,a="url("+this.handCursorURL_+")",e=function(n){n.preventDefault&&n.preventDefault(),n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation()},v=function(){n.marker_.setAnimation(null)};this.getPanes().overlayImage.appendChild(this.labelDiv_),this.getPanes().overlayMouseTarget.appendChild(this.eventDiv_),typeof MarkerLabel_.getSharedCross.processed=="undefined"&&(this.getPanes().overlayImage.appendChild(this.crossDiv_),MarkerLabel_.getSharedCross.processed=!0),this.listeners_=[google.maps.event.addDomListener(this.eventDiv_,"mouseover",function(t){(n.marker_.getDraggable()||n.marker_.getClickable())&&(this.style.cursor="pointer",google.maps.event.trigger(n.marker_,"mouseover",t))}),google.maps.event.addDomListener(this.eventDiv_,"mouseout",function(i){(n.marker_.getDraggable()||n.marker_.getClickable())&&!t&&(this.style.cursor=n.marker_.getCursor(),google.maps.event.trigger(n.marker_,"mouseout",i))}),google.maps.event.addDomListener(this.eventDiv_,"mousedown",function(i){t=!1,n.marker_.getDraggable()&&(r=!0,this.style.cursor=a),(n.marker_.getDraggable()||n.marker_.getClickable())&&(google.maps.event.trigger(n.marker_,"mousedown",i),e(i))}),google.maps.event.addDomListener(document,"mouseup",function(e){var s;if(r&&(r=!1,n.eventDiv_.style.cursor="pointer",google.maps.event.trigger(n.marker_,"mouseup",e)),t){if(i){s=n.getProjection().fromLatLngToDivPixel(n.marker_.getPosition()),s.y+=u,n.marker_.setPosition(n.getProjection().fromDivPixelToLatLng(s));try{n.marker_.setAnimation(google.maps.Animation.BOUNCE),setTimeout(v,1406)}catch(h){}}n.crossDiv_.style.display="none",n.marker_.setZIndex(o),f=!0,t=!1,e.latLng=n.marker_.getPosition(),google.maps.event.trigger(n.marker_,"dragend",e)}}),google.maps.event.addListener(n.marker_.getMap(),"mousemove",function(f){var e;r&&(t?(f.latLng=new google.maps.LatLng(f.latLng.lat()-s,f.latLng.lng()-h),e=n.getProjection().fromLatLngToDivPixel(f.latLng),i&&(n.crossDiv_.style.left=e.x+"px",n.crossDiv_.style.top=e.y+"px",n.crossDiv_.style.display="",e.y-=u),n.marker_.setPosition(n.getProjection().fromDivPixelToLatLng(e)),i&&(n.eventDiv_.style.top=e.y+u+"px"),google.maps.event.trigger(n.marker_,"drag",f)):(s=f.latLng.lat()-n.marker_.getPosition().lat(),h=f.latLng.lng()-n.marker_.getPosition().lng(),o=n.marker_.getZIndex(),c=n.marker_.getPosition(),l=n.marker_.getMap().getCenter(),i=n.marker_.get("raiseOnDrag"),t=!0,n.marker_.setZIndex(1e6),f.latLng=n.marker_.getPosition(),google.maps.event.trigger(n.marker_,"dragstart",f)))}),google.maps.event.addDomListener(document,"keydown",function(r){t&&r.keyCode===27&&(i=!1,n.marker_.setPosition(c),n.marker_.getMap().setCenter(l),google.maps.event.trigger(document,"mouseup",r))}),google.maps.event.addDomListener(this.eventDiv_,"click",function(t){(n.marker_.getDraggable()||n.marker_.getClickable())&&(f?f=!1:(google.maps.event.trigger(n.marker_,"click",t),e(t)))}),google.maps.event.addDomListener(this.eventDiv_,"dblclick",function(t){(n.marker_.getDraggable()||n.marker_.getClickable())&&(google.maps.event.trigger(n.marker_,"dblclick",t),e(t))}),google.maps.event.addListener(this.marker_,"dragstart",function(){t||(i=this.get("raiseOnDrag"))}),google.maps.event.addListener(this.marker_,"drag",function(){t||i&&(n.setPosition(u),n.labelDiv_.style.zIndex=1e6+(this.get("labelInBackground")?-1:1))}),google.maps.event.addListener(this.marker_,"dragend",function(){t||i&&n.setPosition(0)}),google.maps.event.addListener(this.marker_,"position_changed",function(){n.setPosition()}),google.maps.event.addListener(this.marker_,"zindex_changed",function(){n.setZIndex()}),google.maps.event.addListener(this.marker_,"visible_changed",function(){n.setVisible()}),google.maps.event.addListener(this.marker_,"labelvisible_changed",function(){n.setVisible()}),google.maps.event.addListener(this.marker_,"title_changed",function(){n.setTitle()}),google.maps.event.addListener(this.marker_,"labelcontent_changed",function(){n.setContent()}),google.maps.event.addListener(this.marker_,"labelanchor_changed",function(){n.setAnchor()}),google.maps.event.addListener(this.marker_,"labelclass_changed",function(){n.setStyles()}),google.maps.event.addListener(this.marker_,"labelstyle_changed",function(){n.setStyles()})]},MarkerLabel_.prototype.onRemove=function(){var n;for(this.labelDiv_.parentNode.removeChild(this.labelDiv_),this.eventDiv_.parentNode.removeChild(this.eventDiv_),n=0;n<this.listeners_.length;n++)google.maps.event.removeListener(this.listeners_[n])},MarkerLabel_.prototype.draw=function(){this.setContent(),this.setTitle(),this.setStyles()},MarkerLabel_.prototype.setContent=function(){var n=this.marker_.get("labelContent");typeof n.nodeType=="undefined"?(this.labelDiv_.innerHTML=n,this.eventDiv_.innerHTML=this.labelDiv_.innerHTML):(this.labelDiv_.innerHTML="",this.labelDiv_.appendChild(n),n=n.cloneNode(!0),this.eventDiv_.innerHTML="",this.eventDiv_.appendChild(n))},MarkerLabel_.prototype.setTitle=function(){this.eventDiv_.title=this.marker_.getTitle()||""},MarkerLabel_.prototype.setStyles=function(){var n,t;this.labelDiv_.className=this.marker_.get("labelClass"),this.eventDiv_.className=this.labelDiv_.className,this.labelDiv_.style.cssText="",this.eventDiv_.style.cssText="",t=this.marker_.get("labelStyle");for(n in t)t.hasOwnProperty(n)&&(this.labelDiv_.style[n]=t[n],this.eventDiv_.style[n]=t[n]);this.setMandatoryStyles()},MarkerLabel_.prototype.setMandatoryStyles=function(){this.labelDiv_.style.position="absolute",this.labelDiv_.style.overflow="hidden",typeof this.labelDiv_.style.opacity!="undefined"&&this.labelDiv_.style.opacity!==""&&(this.labelDiv_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(opacity='+this.labelDiv_.style.opacity*100+')"',this.labelDiv_.style.filter="alpha(opacity="+this.labelDiv_.style.opacity*100+")"),this.eventDiv_.style.position=this.labelDiv_.style.position,this.eventDiv_.style.overflow=this.labelDiv_.style.overflow,this.eventDiv_.style.opacity=.01,this.eventDiv_.style.MsFilter='"progid:DXImageTransform.Microsoft.Alpha(opacity=1)"',this.eventDiv_.style.filter="alpha(opacity=1)",this.setAnchor(),this.setPosition(),this.setVisible()},MarkerLabel_.prototype.setAnchor=function(){var n=this.marker_.get("labelAnchor");this.labelDiv_.style.marginLeft=-n.x+"px",this.labelDiv_.style.marginTop=-n.y+"px",this.eventDiv_.style.marginLeft=-n.x+"px",this.eventDiv_.style.marginTop=-n.y+"px"},MarkerLabel_.prototype.setPosition=function(n){var t=this.getProjection().fromLatLngToDivPixel(this.marker_.getPosition());typeof n=="undefined"&&(n=0),this.labelDiv_.style.left=Math.round(t.x)+"px",this.labelDiv_.style.top=Math.round(t.y-n)+"px",this.eventDiv_.style.left=this.labelDiv_.style.left,this.eventDiv_.style.top=this.labelDiv_.style.top,this.setZIndex()},MarkerLabel_.prototype.setZIndex=function(){var n=this.marker_.get("labelInBackground")?-1:1;typeof this.marker_.getZIndex()=="undefined"?(this.labelDiv_.style.zIndex=parseInt(this.labelDiv_.style.top,10)+n,this.eventDiv_.style.zIndex=this.labelDiv_.style.zIndex):(this.labelDiv_.style.zIndex=this.marker_.getZIndex()+n,this.eventDiv_.style.zIndex=this.labelDiv_.style.zIndex)},MarkerLabel_.prototype.setVisible=function(){this.labelDiv_.style.display=this.marker_.get("labelVisible")?this.marker_.getVisible()?"block":"none":"none",this.eventDiv_.style.display=this.labelDiv_.style.display},inherits(MarkerWithLabel,google.maps.Marker),MarkerWithLabel.prototype.setMap=function(n){google.maps.Marker.prototype.setMap.apply(this,arguments),this.label.setMap(n)},FRNetworkUserFollow=function(){function it(){if(window.FRSocial.loginUserId==0)n.find(".btn-journal-follow").removeClass("loop-hide"),n.find(".btn-journal-follow").html('Follow<span class="hidden-sm hidden-xs"> on Loop</span>');else{var t;t=window.FRJournalDetails.JournalType=="journal"?{journalId:window.FRJournalDetails.JournalId}:{journalId:window.FRJournalDetails.SectionId},$.ajax({url:"/proxy/Follow/followjournalstatus",data:t,type:"POST",traditional:!0,dataType:"json",success:function(n){g(n)}})}}function tt(){if(window.FRSocial.loginUserId==0)n.find(".teaser-follow button").map(function(){$(this).data("userId")>0&&$(this).addClass("btn-follow-orange").text("Follow").removeClass("follow-hide")});else{var t={userId:nt()};$.ajax({url:"/proxy/Follow/FollowStatus",data:t,type:"POST",traditional:!0,dataType:"json",success:function(n){d(n)}})}}function nt(){var t=[];return n.find(".follow-button[data-user-id]").each(function(n,i){t.push(parseInt($(i).data("userId")))}),_.uniq(t)}function g(t){t!=0?(n.find(".btn-journal-follow").html("Following"),n.find(".btn-journal-follow").addClass("following")):n.find(".btn-journal-follow").html('Follow<span class="hidden-sm hidden-xs"> on Loop</span>'),n.find(".btn-journal-follow").removeClass("loop-hide")}function d(t){if(t!=null){if(t.LoggedInUserID==0&&n.find(".teaser-follow button").map(function(){$(this).data("userId")>0&&$(this).addClass("btn-follow-orange").text("Follow").removeClass("follow-hide")}),!t.FollowList||!t.FollowList.length)return;$(t.FollowList).each(function(t,i){if(i.UserId>0){var u=n.find(".follow"),r=u.find(".follow-button[data-user-id="+i.UserId+"]");i.IsFollowButtonVisible?(i.IsBlocked?r.addClass("btn-follow-blocked").removeClass("btn-follow-orange").text("Blocked"):i.IsFollowing?r.text("Following").addClass("btn-follow-grey").removeClass("btn-follow-orange"):i.IsBlockingMe?r.addClass("btn-follow-blockingme btn-follow-orange").text("Follow"):r.text("Follow").addClass("btn-follow-orange"),r.removeAttr("data-user-id").removeClass("follow-hide")):r.removeAttr("data-user-id")}})}}function k(){n.on("click",".follow-button",function(){var n=$(this);if(n.hasClass("follow-editor-overview")?FRTracking.event("JP_EBW_Action","link","follow_loop"):FRTracking.event("JP_EB_Action","link","follow_loop"),window.FRSocial.loginUserId==0)return f(),!1;if(n.hasClass("btn-unfollow")||n.hasClass("btn-follow-grey")){if(n.checkDuplicateEvent())return;n.removeClass("btn-follow-grey btn-unfollow").addClass("btn-follow-orange").text("Follow"),b(n)}else if(n.hasClass("btn-follow-blockingme"))o();else if(n.hasClass("btn-follow-orange")){if(n.checkDuplicateEvent())return;n.addClass("btn-follow-grey").removeClass("btn-follow-orange").text("Following"),p(n)}else if(n.hasClass("btn-follow-blocked"))return});n.on("mouseenter",".btn-follow-grey",function(){var n=$(this);n.addClass("btn-unfollow").removeClass("btn-follow-grey").text("Unfollow")});n.on("mouseleave",".btn-unfollow",function(){var n=$(this);n.addClass("btn-follow-grey").removeClass("btn-follow-orange btn-unfollow").text("Following")});n.on("click",".btn-journal-follow",function(){if(FRTracking.event("JP_Action","button","follow_loop"),window.FRSocial.loginUserId==0)return f(),!1;var t,i=$(this);if(n.find(".btn-journal-follow").hasClass("following")){if(i.checkDuplicateEvent())return;window.FRJournalDetails.JournalType=="journal"?(t={journalId:window.FRJournalDetails.JournalId},c(t)):(t={sectionId:window.FRJournalDetails.SectionId},h(t))}else{if(i.checkDuplicateEvent())return;window.FRJournalDetails.JournalType=="journal"?(t={journalId:window.FRJournalDetails.JournalId},a(t)):(t={sectionId:window.FRJournalDetails.SectionId},l(t))}});n.on("mouseenter",".btn-journal-follow.following",function(){var n=$(this);n.text("Unfollow").addClass("btn-loop-unfollow")});n.on("mouseleave",".btn-journal-follow.following",function(){var n=$(this);n.text("Following").removeClass("btn-loop-unfollow")})}function b(n){var t=n.data("userId");s(t,n,"unfollow",w)}function w(t,r){var u,o;if(t!=null&&t.LoggedInUserID==0){f();return}if(t!=null&&t.FollowList!=null&&t.FollowList.length>0){if(u=n.find(".teaser-follow button").map(function(){if($(this).data("userId")==t.FollowList[0].UserId)return this}),t.FollowList[0].IsBlockingMe||t.FollowList[0].IsBlocked){u.addClass("btn-follow-grey").removeClass("btn-follow-orange").text("Following"),i();return}o={userId:t.FollowList[0].UserId},$.ajax({url:"/proxy/Follow/UnFollow",type:"POST",data:o,success:function(){u.addClass("btn-follow-orange").removeClass("btn-follow-grey").text("Follow"),u.checkDuplicateEvent("clear")},error:function(){u.addClass("btn-follow-grey").removeClass("btn-follow-orange").text("Following"),e(),u.checkDuplicateEvent("clear")}})}else r.addClass("btn-follow-grey").removeClass("btn-follow-orange").text("Following"),e()}function p(n){var t=n.data("userId");s(t,n,"follow",y)}function y(t,r){var u,e;if(t!=null&&t.LoggedInUserID==0){f();return}if(t!=null&&t.FollowList!=null&&t.FollowList.length>0){if(u=n.find(".teaser-follow button").map(function(){if($(this).data("userId")==t.FollowList[0].UserId)return this}),t.FollowList[0].IsBlocked){u.addClass("btn-follow-orange").removeClass("btn-follow-grey").text("Follow"),i();return}if(t.FollowList[0].IsBlockingMe){u.addClass("btn-follow-orange").removeClass("btn-follow-grey").text("Follow"),o();return}e={userId:t.FollowList[0].UserId},$.ajax({url:"/proxy/Follow/Follow",type:"POST",data:e,success:function(){u.addClass("btn-follow-grey").removeClass("btn-follow-orange").text("Following"),u.checkDuplicateEvent("clear")},error:function(){u.addClass("btn-follow-orange").removeClass("btn-follow-grey").text("Follow"),i(),u.checkDuplicateEvent("clear")}})}else r.addClass("btn-follow-orange").removeClass("btn-follow-grey").text("Follow"),i()}function s(n,t,i,r){var u={userId:n};$.ajax({url:"/proxy/Follow/FollowStatus",data:u,type:"POST",traditional:!0,dataType:"json",success:function(n){return r(n,t)},error:function(){v(i,t)}})}function v(n,t){n=="follow"?(t.addClass("btn-follow-orange").removeClass("btn-follow-grey").text("Follow"),i()):n=="unfollow"&&(t.addClass("btn-follow-grey").removeClass("btn-follow-orange").text("Following"),e())}function e(){throw new FRError({className:"FRNetworkUserFollow",methodName:"Follow",message:"Failed to UnFollow"});}function i(){throw new FRError({className:"FRNetworkUserFollow",methodName:"Follow",message:"Failed to Follow"});}function f(){if($(".modal.login-modal").length){$(".modal.login-modal").modal("show");return}var t=window.FRConfiguration.SharepointWebsiteUrl+"/Login.aspx?returnurl="+document.location.href,i=$(['<div class="modal login-modal fade" data-backdrop="static">','<div class="modal-dialog">','<div class="modal-content">','<div class="modal-header">','<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>',"<h4>Login Required</h4>","</div>",'<div class="modal-body">',"<p>This action requires you to be registered with Frontiers and logged in. To register or login click <a href="+t+">here.</a> </p>","</div>",'<div class="modal-footer">','<button type="button" class="btn btn-flat btn-close btn-new-orange" data-dismiss="modal">Close</button>',"</div>","</div>","</div>","</div>"].join(""));n.append(i),n.find(".modal.login-modal").modal("show")}function o(){$.FRModal({modalClass:"popup-block",contentHeader:$("<h3>Network</h3>"),contentBody:$("<p> This person cannot be followed. </p>")})}function a(i){var r=n.find(".btn-journal-follow").text();u("True"),$.ajax({url:"/proxy/follow/followjournal",type:"POST",data:i,success:function(n){n!="True"&&(u(n),t(r))},error:function(){t(r)}})}function l(i){var r=n.find(".btn-journal-follow").text();u("True"),$.ajax({url:"/proxy/follow/followsection",type:"POST",data:i,success:function(n){n!="True"&&(u(n),t(r))},error:function(){t(r)}})}function u(t){t!="True"?(n.find(".btn-journal-follow").removeClass("following"),n.find(".btn-journal-follow").html('Follow<span class="hidden-sm hidden-xs"> on Loop</span>'),n.find(".btn-journal-follow").checkDuplicateEvent("clear")):(n.find(".btn-journal-follow").text("Following"),n.find(".btn-journal-follow").addClass("following"),n.find(".btn-journal-follow").checkDuplicateEvent("clear"))}function c(i){var u=n.find(".btn-journal-follow").text();r("True"),$.ajax({url:"/proxy/follow/unfollowjournal",type:"POST",data:i,success:function(n){n!="True"&&(r(n),t(u))},error:function(){t(u)}})}function h(i){var u=n.find(".btn-journal-follow").text();r("True"),$.ajax({url:"/proxy/follow/unfollowsection",type:"POST",data:i,success:function(n){n!="True"&&(r(n),t(u))},error:function(){t(u)}})}function r(t){t!="True"?(n.find(".btn-journal-follow").text("Following"),n.find(".btn-journal-follow").addClass("following"),n.find(".btn-journal-follow").checkDuplicateEvent("clear")):(n.find(".btn-journal-follow").removeClass("following").removeClass("btn-loop-unfollow"),n.find(".btn-journal-follow").html('Follow<span class="hidden-sm hidden-xs"> on Loop</span>'),n.find(".btn-journal-follow").checkDuplicateEvent("clear"))}function t(n){n=="Follow on Loop"?ut():n=="Following"&&rt()}function rt(){throw new FRError({className:"FRNetworkUserFollowJournal",methodName:"Follow",message:"Failed to UnFollow Journal"});}function ut(){throw new FRError({className:"FRNetworkUserFollowJournal",methodName:"Follow",message:"Failed to Follow Journal"});}var n=$(".page-container");return $(function(){k()}),{fillUserFollow:tt,fillJournalFollow:it}}()